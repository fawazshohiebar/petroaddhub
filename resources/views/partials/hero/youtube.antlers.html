<section class="relative min-h-dvh md:min-h-[800px] h-dvh overflow-hidden -mt-34 pt-46.3 flex items-center ">    <!-- YouTube Video Background -->
    <div class="absolute inset-0 w-full h-full z-0 video-container">
        <div class="youtube-player" id="youtube-player" data-video-id="{{ video }}" data-start-time="{{ starting_time }}" data-end-time="{{ ending_time }}">
            <!-- YouTube iframe will be inserted here by the API -->
        </div>
        <!-- Dark Overlay -->
{{# <div class="absolute inset-0 bg-gradient-to-r from-[#00000000]  to-[#00000000] z-10"></div> #}}
    </div>
    
    {{partial:hero/content}}

    {{ partial:hero/scroll }}
</section>

<!-- Load YouTube IFrame API -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
(function() {
    var startTime = 10;
    var endTime = 60;
    var videoId = '';
    var player = null;
    var timeCheckInterval = null;
    var isReady = false;
    
    function initPlayer() {
        var playerElement = document.getElementById('youtube-player');
        if (!playerElement) {
            console.warn('YouTube player element not found');
            return;
        }
        
        videoId = playerElement.getAttribute('data-video-id');
        startTime = parseInt(playerElement.getAttribute('data-start-time')) || 0;
        endTime = parseInt(playerElement.getAttribute('data-end-time')) || 0;
        
        if (!videoId) {
            console.warn('No YouTube video ID provided');
            return;
        }
        
        // Create the YouTube player using the API (better control & autoplay support)
        player = new YT.Player('youtube-player', {
            videoId: videoId,
            playerVars: {
                'autoplay': 1,
                'controls': 0,
                'showinfo': 0,
                'rel': 0,
                'mute': 1,
                'loop': 1,
                'playlist': videoId,
                'start': startTime,
                'modestbranding': 1,
                'playsinline': 1,
                'enablejsapi': 1,
                'origin': window.location.origin
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange,
                'onError': onPlayerError
            }
        });
    }
    
    function onPlayerReady(event) {
        isReady = true;
        event.target.mute();
        event.target.playVideo();
        
        // Start time monitoring for custom end time looping
        if (endTime > startTime) {
            startTimeMonitoring();
        }
    }
    
    function onPlayerStateChange(event) {
        // If video ended naturally, restart from start time
        if (event.data === YT.PlayerState.ENDED) {
            player.seekTo(startTime);
            player.playVideo();
        }
        
        // If video is paused unexpectedly, try to play it
        if (event.data === YT.PlayerState.PAUSED && isReady) {
            setTimeout(function() {
                if (player && player.getPlayerState() === YT.PlayerState.PAUSED) {
                    player.playVideo();
                }
            }, 100);
        }
    }
    
    function onPlayerError(event) {
        console.error('YouTube Player Error:', event.data);
        // Error codes: 2 = invalid video ID, 5 = HTML5 error, 100 = not found, 101/150 = embedding disabled
    }
    
    function startTimeMonitoring() {
        if (timeCheckInterval) {
            clearInterval(timeCheckInterval);
        }
        
        timeCheckInterval = setInterval(function() {
            if (player && typeof player.getCurrentTime === 'function') {
                var currentTime = player.getCurrentTime();
                if (currentTime >= endTime) {
                    player.seekTo(startTime);
                    player.playVideo();
                }
            }
        }, 500);
    }
    
    // Handle YouTube API ready state
    function onYouTubeReady() {
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initPlayer);
        } else {
            initPlayer();
        }
    }
    
    // Check if YouTube API is already loaded
    if (window.YT && window.YT.Player) {
        onYouTubeReady();
    } else {
        // Store previous callback if exists
        var previousCallback = window.onYouTubeIframeAPIReady;
        window.onYouTubeIframeAPIReady = function() {
            if (previousCallback) previousCallback();
            onYouTubeReady();
        };
    }
})();
</script>

<style>
    .video-container {
        overflow: hidden;
    }
    
    .video-container iframe {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100vw;
        height: 56.25vw; /* 16:9 aspect ratio */
        min-height: 100vh;
        min-width: 177.77vh; /* 16:9 aspect ratio */
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 0;
    }
    
    /* Ensure video covers on all screen sizes */
    @media (max-aspect-ratio: 16/9) {
        .video-container iframe {
            width: 177.77vh;
            height: 100vh;
        }
    }
    
    @media (min-aspect-ratio: 16/9) {
        .video-container iframe {
            width: 100vw;
            height: 56.25vw;
        }
    }
    
    /* Mobile portrait - ensure coverage */
    @media (max-aspect-ratio: 1/1) {
        .video-container iframe {
            width: 200vh;
            height: 112.5vh;
        }
    }
    
    /* Very tall mobile screens */
    @media (max-aspect-ratio: 9/16) {
        .video-container iframe {
            width: 250vh;
            height: 140.625vh;
        }
    }
</style>